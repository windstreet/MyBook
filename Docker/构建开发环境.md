# 如何构建基于docker的开发环境

Docker本来就是虚拟化技术，基于Docker来构建开发环境顺理成章。在Mac下以django开发环境的构建为例


## 一、基本思路

1) 创建一个用于开发Django App的目录   
```bash
mkdir django-example && cd django-example
```

---

2) 构建基本开发环境   
```bash
touch Dockerfile
touch pip.conf requirements.txt
```

`pip.conf` 文件填入以下内容，以便一会用pip安装Python 模块时使用阿里云镜像加速：

```
[global]
index-url = http://mirrors.aliyun.com/pypi/simple/

[install]
trusted-host=mirrors.aliyun.com
```

`requirements.txt` 文件中填入要安装的Python 模块：

```
django
```

编写构建开发环境的 `Dockerfile` 文件，填入以下内容：

```
# MAINTAINER        Lrw <666666666@qq.com>
# DOCKER-VERSION    18.09.2
#
# Dockerizing Python: Dockerfile for building python applications


FROM python:2.7.12
MAINTAINER Lrw <666666666@qq.com>

WORKDIR /usr/src/app

# 使用阿里云的pip镜像
COPY pip.conf /root/.pip/pip.conf 
COPY requirements.txt /usr/src/app/requirements.txt
RUN pip install -r /usr/src/app/requirements.txt

EXPOSE 8000

CMD ["bash"]
```

然后执行下面命令构建镜像：     
```bash
docker build -t lrw/django-example:0.1 .
```

构建成功后，执行 `docker images` 命令，可以查看到当前构建好的image     
```bash
docker images

REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
lrw/django-example   0.1                 b9f2e9c2a39a        44 seconds ago      701MB
```


---


3) 使用构建的image拉起开发环境

执行下面命令，可以以前台形式拉起django-example镜像的一个container：

```bash
docker run -it --rm -v $(pwd):/usr/src/app lrw/django-example:0.1
```

上面命令使用了 `data volume`，把当前目录挂载到container中的工作目录下。    
这样当前目录下的所有文件都会映射到container的工作目录下。     
在工作目录下的所有改动，也都会保存到宿主机的当前目录下。  


---


4) 创建django项目

上一步的命令创建了一个安装了django的交互式的 `container`，直接在该container中执行创建django项目的命令即可：

```bash
root@45c0bf5f7068:/usr/src/app# django-admin startproject dj_example
```

上述命令，在container中基于django的命令创建了一个django项目，  
由于上一步操作时把宿主机的当前目录挂载到container的工作目录下，  
因此，刚刚在container中创建的django项目，在宿主机上也能看到。  
  
  
容器 container:
```bash
root@45c0bf5f7068:/usr/src/app# ls
Dockerfile  dj_example	pip.conf  requirements.txt
```

退出容器   
```bash
root@45c0bf5f7068:/usr/src/app# exit
```


宿主机： 

即最初创建的目录：/Users/linrenwei/funny/django-example

```bash
pwd
>>> /Users/linrenwei/funny/django-example

django-example ls
>>> Dockerfile       dj_example       pip.conf         requirements.txt
```


---


5) 启动django项目
```bash
docker run -it --rm -p 8000:8000 -v $(pwd):/usr/src/app lrw/django-example:0.1 python dj_example/manage.py runserver 0.0.0.0:8000
```


---


