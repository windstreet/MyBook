# 基于RabbitMQ的RPC

## 1、`Callback queue`回调队列
- 一个客户端向服务器发送请求，服务器端处理请求后，将其处理结果保存在一个存储体中。
- 而客户端为了获得处理结果，那么客户端在向服务器发送请求时，同时发送一个`回调队列地址reply_to`。

## 2、`Correlation id`关联标识
- 一个客户端可能会发送多个请求给服务器，
- 当服务器处理完后，客户端无法辨别在回调队列中的响应具体和那个请求时对应的。
- 为了处理这种情况，客户端在发送每个请求时，同时会附带一个独有`correlation_id`属性，
- 这样客户端在回调队列中根据`correlation_id`字段的值就可以分辨此响应属于哪个请求。

## 3、流程
- `客户端发送请求`：
    - `某个应用`将请求信息交给`客户端`，
    - 然后客户端发送`RPC请求`，
    - 在发送RPC请求到`RPC请求队列`时，客户端至少发送带有`reply_to`以及`correlation_id`两个属性的信息。

- `服务器端工作流`： 
    - 等待接受客户端发来RPC请求，
    - 当请求出现的时候，服务器从`RPC请求队列`中取出请求，
    - 然后处理后，将`响应`发送到`reply_to`指定的`回调队列`中

- `客户端接受处理结果`： 
    - 客户端等待`回调队列`中出现响应，
    - 当响应出现时，它会根据响应中`correlation_id`字段的值，将其返回给对应的应用


